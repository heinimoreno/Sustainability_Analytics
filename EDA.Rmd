---
output:
  html_document:
    code_folding: hide
urlcolor: blue
---

```{r child = 'Knitr_setup.Rmd'}
```

# EDA

## Temperature from homogenous data source

homogenous data: Adjusting historical measurements to current standards

```{r message=FALSE, warning=FALSE}
# Laden der installierten Pakete
library(ggplot2)
library(dplyr)
library(stats)
library(zoo)

# Pfad zum Unterordner
data_folder <- "Daten/"

# Funktion zum Extrahieren des Standortnamens aus dem Dateinamen
get_location <- function(file_name) {
  if (grepl("Engelberg", file_name)) {
    return("Engelberg")
  } else if (grepl("Luzern", file_name)) {
    return("Luzern")
  } else {
    return("Unknown")
  }
}

# Laden der Datensätze für Engelberg und Luzern
Engelberg <- read.csv(paste0(data_folder, "Messreihe_Engelberg.csv"))
Luzern <- read.csv(paste0(data_folder, "Messreihe_Luzern.csv"))

# Extrahieren des Standortnamens und Hinzufügen zur Datensätze
Engelberg$Location <- get_location("Messreihe_Engelberg.csv")
Luzern$Location <- get_location("Messreihe_Luzern.csv")

# Zusammenführen der Daten
combined_data <- rbind(Engelberg, Luzern)

# Umwandlung der Spalten 'Year' und 'Month' in ein Datumsformat
combined_data$Date <- as.Date(paste(combined_data$Year, combined_data$Month, "01", sep = "-"))

# Gruppieren nach Jahr und Standort und Berechnen des Durchschnitts pro Jahr
summary_data <- combined_data %>%
  group_by(Year, Location) %>%
  summarise(Avg_Temperature = mean(Temperature),
            Avg_Precipitation = mean(Precipitation))

# Plotten der Temperaturzeitreihe für Engelberg und Luzern
avg_temp_plot <- ggplot(summary_data, aes(x = Year, y = Avg_Temperature, color = Location)) +
  geom_line() +
  labs(x = "Year", y = "Average Temperature (°C)", color = "Location") +
  ggtitle("Average Temperature Time Series for Engelberg and Luzern") +
  theme_minimal()

# Plotten der Niederschlagszeitreihe für Engelberg und Luzern
avg_preci_plot <- ggplot(summary_data, 
                         aes(x = Year, y = Avg_Precipitation, color = Location)) +
  geom_line() +
  labs(x = "Year", y = "Average Precipitation (mm)", color = "Location") +
  ggtitle("Average Precipitation Time Series for Engelberg and Luzern") +
  theme_minimal()

# Gruppieren nach 5-Jahres-Schritten und Berechnen des Durchschnitts pro Zeitraum
summary_data_5yr <- combined_data %>%
  mutate(Year_Group = as.integer((Year - 1) %/% 5) * 5 + 1) %>%
  group_by(Year_Group, Location) %>%
  summarise(Avg_Temperature = mean(Temperature),
            Avg_Precipitation = mean(Precipitation))

# Plotten der Temperaturzeitreihe für Engelberg und Luzern (5-Jahres-Periode)
avg_5temp_plot <- ggplot(summary_data_5yr, aes(x = Year_Group, y = Avg_Temperature, color = Location)) +
  geom_line() +
  labs(x = "5-Year Period", y = "Average Temperature (°C)", color = "Location") +
  ggtitle("Average Temperature Time Series for Engelberg and Luzern (5-Year Period)") +
  theme_minimal()

# Plotten der Niederschlagszeitreihe für Engelberg und Luzern (5-Jahres-Periode)
avg_5preci_plot <- ggplot(summary_data_5yr, 
                          aes(x = Year_Group, y = Avg_Precipitation, color = Location)) +
  geom_line() +
  labs(x = "5-Year Period", y = "Average Precipitation (mm)", color = "Location") +
  ggtitle("Average Precipitation Time Series for Engelberg and Luzern (5-Year Period)") +
  theme_minimal()

# Konvertieren der aggregierten Daten in eine Zeitreihe
temp_ts <- ts(summary_data$Avg_Temperature, start = c(1864, 1), frequency = 12)
precip_ts <- ts(summary_data$Avg_Precipitation, start = c(1864, 1), frequency = 12)

# Fehlende Werte in der Zeitreihe ersetzen (hier mit 0)
temp_ts_filled <- na.fill(temp_ts, 0)
precip_ts_filled <- na.fill(precip_ts, 0)

# Anwenden der decompose-Funktion
temp_decomposed <- decompose(temp_ts_filled)
precip_decomposed <- decompose(precip_ts_filled)
```

###  Visualizing

We will be using the homogenous data from Luzern to compliment the Seebodenalp (Rigi) temperature data.

```{r warning=FALSE}
avg_temp_plot
```

The plot displays a time series of average temperatures for Engelberg and Luzern, with the x-axis representing the years from approximately 1900 to just beyond the year 2000 and the y-axis indicating temperature in degrees Celsius. Engelberg's temperature is depicted with a red line, while Luzern's temperature is shown with a blue line. Both locations show fluctuations that suggest seasonality and an overall upward trend in temperatures over the century, indicating a rise in average temperatures.

```{r warning=FALSE}
avg_5temp_plot
```

The plot illustrates a time series of average temperatures over a 5-year period for Engelberg (red line) and Luzern (blue line), showing a clear upward trend in temperatures for both locations from 1900 to the 2000s.

```{r warning=FALSE}
avg_preci_plot
```

The graph shows the average precipitation time series for Engelberg and Luzern, with both locations showing significant variability in precipitation over the years from 1900 to beyond 2000. The Engelberg data is depicted with a red line and exhibits more pronounced spikes, whereas the Luzern data, represented by a blue line, shows somewhat less volatility in average precipitation levels.

```{r warning=FALSE}
avg_5preci_plot
```

```{r}
# Plotten der saisonalen, trendigen und saisonal bereinigten Komponenten der Temperaturzeitreihe
plot(temp_decomposed)
```

The plot presents a **temperature** decomposition of an additive time series from 1865 to 1890 into three components: observed, trend, and seasonal. The observed component shows the actual time series data with fluctuations, while the trend component indicates a relatively stable or slightly increasing trend over the 25-year period. The seasonal component displays consistent, periodic fluctuations suggesting a regular pattern that repeats annually, while the random component, which represents the residual noise, shows irregularities that cannot be attributed to the trend or seasonal effects.

```{r}
# Plotten der saisonalen, trendigen und saisonal bereinigten Komponenten der Niederschlagszeitreihe
plot(precip_decomposed)

```

The chart presents a **preciption** decomposition of an additive time series from 1865 to 1890 into three components: observed, trend, and seasonal. The observed component shows the actual time series data with fluctuations, while the trend component indicates a relatively stable or slightly increasing trend over the 25-year period. The seasonal component displays consistent, periodic fluctuations suggesting a regular pattern that repeats annually, while the random component, which represents the residual noise, shows irregularities that cannot be attributed to the trend or seasonal effects.

## Temperature from meteo swiss

```{r}
library(tidyverse)

#### Daten einlesen ####

# Engelberg
engelberg <- read.csv("Daten/Engelberg_data.csv", sep = ';', na.strings = c('-',''))

engelberg$time <- as.Date(as.character(engelberg$time), format = "%Y%m%d")
engelberg_clean <- engelberg %>% select('stn',
                                        'time',
                                        'tre200nn')

# Seeboden
seeboden <- read.csv("Daten/Seebodenalp_data.csv", sep = ';', na.strings = c('-',''))
# Convert integer dates to Date objects
seeboden$time <- as.Date(as.character(seeboden$time), format = "%Y%m%d")
seeboden_clean <- seeboden %>% select('stn',
                                      'time',
                                      'tre200nn')
```

**Engelberg**: inspection of the needed variables

```{r}
str(engelberg_clean)
```

```{r}
summary(engelberg_clean)
```

**Seeboden**: inspection of the needed variables

```{r}
# NA anschauen
str(seeboden_clean)
```

```{r}
summary(seeboden_clean)
```

### Visualizations

**tre200nn** = Lufttemperatur 2 m ¸ber Boden; Nachtminimum (18 UTC Vortag bis 6 UTC aktueller Tag)

```{r warning=FALSE}
#### EDA ####
# Histogram
hist_engelberg <- ggplot(engelberg_clean, aes(x = tre200nn)) +
  geom_histogram(bins = 30, fill = "blue", color = "black") +
  labs(title = "Distribution of Engelberg Temperature", x = "Temperature", y = "Count")

hist_seeboden <- ggplot(seeboden_clean, aes(x = tre200nn)) +
  geom_histogram(bins = 30, fill = "orange", color = "black") +
  labs(title = "Distribution of Seebodenalp Temperature", x = "Temperature", y = "Count")

# Boxplot
boxplot_engelberg <- ggplot(engelberg_clean, aes(y = tre200nn)) +
  geom_boxplot(fill = "blue", color = "darkred") +
  labs(title = "Boxplot of Engelberg Temperature", y = "Temperature")

boxplot_seeboden <- ggplot(seeboden_clean, aes(y = tre200nn)) +
  geom_boxplot(fill = "orange", color = "darkred") +
  labs(title = "Boxplot of Seebodenalp Temperature", y = "Temperature")

# Timeseries
timeseries_engelberg <- ggplot(engelberg_clean, aes(x = time, y = tre200nn)) +
  geom_line() +
  labs(title = "Time Series of Engelberg Temperature", x = "Time", y = "Temperature")

timeseries_seeboden <- ggplot(seeboden_clean, aes(x = time, y = tre200nn)) +
  geom_line() +
  labs(title = "Time Series of Seebodenalp Temperature", x = "Time", y = "Temperature")
```

#### Histogram

```{r warning=FALSE}
hist_engelberg
```

This histogram shows the temperature distribution in Engelberg, with most occurrences between 0 and 5 degrees Celsius. The data spans a broad range from below -20 to above 20 degrees Celsius, showing significant variability in temperatures. The distribution appears slightly left-skewed, suggesting that lower temperatures are more frequent than higher ones.

```{r warning=FALSE}
hist_seeboden
```

This histogram displays the temperature distribution in Seebodenalp (Rigi), with a symmetric shape centered around 5 to 10 degrees Celsius, indicating a normal distribution pattern. The temperatures range from below -20 to above 20 degrees Celsius, with the highest frequency of occurrences in the previously mentioned central range.

Compared to the Engelberg histogram, the Seebodenalp histogram shows a more normal distribution with temperatures clustered around a higher central range, whereas Engelberg's distribution was slightly left-skewed with a mode closer to 0 to 5 degrees Celsius. Additionally, Seebodenalp's temperature variability appears narrower with fewer extreme cold temperatures.

#### Boxplot

```{r warning=FALSE}
boxplot_engelberg
```

This boxplot of Engelberg temperature shows that the median temperature is slightly above 0 degrees Celsius, and the interquartile range (IQR) spans approximately from 5 to 15 degrees Celsius, indicating that the middle 50% of the temperatures are within this range. The whiskers extend from near -20 degrees Celsius to just above 20 degrees Celsius, suggesting that the majority of temperatures fall within this range, with some outliers on the lower end. The presence of several individual points below the lower whisker indicates outlier temperatures that are significantly colder than the rest.

```{r warning=FALSE}
boxplot_seeboden
```

The boxplot for Seebodenalp (Rigi) temperature indicates a median temperature close to 10 degrees Celsius with an interquartile range from approximately 0 to 20 degrees Celsius, suggesting that 50% of the temperatures lie within this warmer range. Similar to Engelberg, there are outliers shown below the bottom whisker, indicating occasional extreme cold temperatures.

Compared to Engelberg's boxplot, the Seebodenalp boxplot demonstrates a higher median temperature and a narrower interquartile range, indicating less variability in temperature. Furthermore, while both locations show outliers, Engelberg appears to have a broader range of extreme cold temperatures.

#### Historic Time Series

```{r warning=FALSE}
timeseries_engelberg
```

What we see in this timeseries, is that there are missing data in the 1980s and it shows a seasonality. This is because the data still includes the summer months.

```{r warning=FALSE}
timeseries_seeboden
```

The data starts from the 1990s and also includes a seasonality aspect as the Engelberg timeseries does. This time series also presents higher temperature than the Engelberg one.
